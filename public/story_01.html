<!--
    IMD3901B Design Studio 3 Winter 2022
    Term Project - The Sacred Meeting Place
    Triple Peanuts - Angelina Belingan, Jacqueline Lee, Violet Nguyen 
-->

<!--
   Cave Art 1 - Sky World: Thunderbird Story
-->

<!DOCTYPE html>
<html>
<head>
    <title>The Sacred Meeting Place</title>
    <meta name="description" content="The Sacred Meeting Place, a WebVR storytelling experience.">
    <script src="/js/aframe.min.js"></script>
    <script src="/js/aframe-environment-component.min.js"></script>
    <script src="/js/wall-interaction-1.js"></script>
    <script src="/js/wall-interaction-2.js"></script>
    <script src="/js/thunderbird.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="/js/aframe-particle-system-component.js"></script>
    <script src="https://unpkg.com/aframe-play-sound-on-event@1.0.2/dist/aframe-play-sound-on-event.min.js"></script>
    
    <script>
        AFRAME.registerComponent('start-narration', {
           init: function() {
                console.log('scene loaded');
                document.querySelector('#text-window').style.display='none';
           } 
        });
        
        const startNarration = function() {
            // Show text pop-up window
            document.querySelector('#text-window').style.display='block';

            // Start narration audio
            var narrationAudio = document.querySelector('narration');
                narration.forEach(function(soundEntity) {
                soundEntity.components.sound.playSound();
            });
        }
    </script>

    <link rel="stylesheet" href="/css/user-gesture.css">
</head>
    
    <body>
        <a-scene id="cave-one" fog="type:exponential">
            <a-assets timeout="1000">

                <!-- Import models and other assets here -->
                <img id="cave-texture" src="Textures/cave-texture.jpg">
                <a-assets-item id="Thunderbird" src="assets/Thunderbird/scene.gltf"></a-assets-item>
                <a-assets-item id="Whale" src="assets/Whale/scene.gltf"></a-assets-item>
                <a-assets-item id="Panther" src="assets/Panther/scene.gltf"></a-assets-item>
                <a-assets-item id="Snake" src="assets/Snake/scene.gltf"></a-assets-item>

                <!-- Import narration audio -->
                <audio id="thunderbird_01" src="\assets\Audio\narration\Thunderbird\thunderbird_01.mp3" preload="auto" crossorigin="anonymous"volume="1"></audio>
                <audio id="thunderbird_02" src="\assets\Audio\narration\Thunderbird\thunderbird_02.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_03" src="\assets\Audio\narration\Thunderbird\thunderbird_03.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_04" src="\assets\Audio\narration\Thunderbird\thunderbird_04.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_05" src="\assets\Audio\narration\Thunderbird\thunderbird_05.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_06" src="\assets\Audio\narration\Thunderbird\thunderbird_06.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_07" src="\assets\Audio\narration\Thunderbird\thunderbird_07.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_08" src="\assets\Audio\narration\Thunderbird\thunderbird_08.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id="thunderbird_09" src="\assets\Audio\narration\Thunderbird\thunderbird_09.mp3" preload="auto" crossorigin="anonymous"></audio>
            </a-assets>

            <!--Camera controls-->
            <a-entity camera wasd-controls look-controls position="0 1.6 0">
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; object:.interactive"></a-entity>
                <a-entity light="type:spot; intensity:0.6; castShadow:true; shadowBias:-0.0005; angle:40; penumbra:1.0;" position="0.5 -0.5 0" rotation="0 0 0"></a-entity>
            </a-entity>

            <!-- environment (need to change sky colour to see the rain)-->
            <a-entity environment="preset:forest; ground:flat; dressingAmount:100"></a-entity>            

            <!-- whale -->
            <a-entity position="10 8 -25" scale="1 1 1" rotation="0 -90 0" gltf-model="#Whale"></a-entity>
            <a-entity
                sound="src: #thunderbird_05"
                play-sound-on-event="mode: toggle-stop; event: click"
                geometry="primitive:box; width:1.8; height:0.8; depth:0.2;" material="color:white;"
                position="10 1.4 -15" rotation="-18 0 0" scale="1 1 1" shadow>
                <a-entity text="value: It is said that the Thunderbird would hunt whales and could pick them up with its talons.;
                                color:black; font:roboto; width:1.5; anchor:center; baseline:top; wrapCount:25;" position="0 0.1 0.2"></a-entity>
            </a-entity>

            <!-- Panther -->
            <a-entity position="-20 2.5 -15" scale="5 5 5" rotation="0 0 0" gltf-model="#Panther"></a-entity>
            <a-entity
                sound="src: #thunderbird_08"
                play-sound-on-event="mode: toggle-stop; event:click"
                geometry="primitive:box; width:2.0; height:0.8; depth:0.2;" material="color:white;"
                position="-18 1.4 -10" rotation="-18 0 0" scale="1 1 1" shadow>
                <a-entity text="value:  In Algonquian mythology, the Thunderbird controls the upper world while the underworld is controlled by the underwater panther or Great Horned Serpent, in which the Thunderbird threw lightning at them to protect humans.;
                                color:black; font:roboto; width:1.5; anchor:center; baseline:top; wrapCount:30;" position="0 0.26 0.2"></a-entity>
            </a-entity>

            <!-- Snake -->
            <a-entity position="30 0 -10" scale="1 1 1" rotation="0 0 0" gltf-model="#Snake"></a-entity>
            <a-entity
                sound="src: #thunderbird_09"
                play-sound-on-event="mode: toggle-stop; event: click"
                geometry="primitive: box; width:2.0; height:0.8; depth:0.2;" material="color:white;" 
                position="30 1.4 -5" rotation="-18 0 0" scale="1 1 1" shadow>
                <a-entity text="value: It was believed that the Thunderbirds were ancestors of the human race and helped to create the universe.;
                                color:black; font:roboto; width:1.5; anchor:center; baseline:top; wrapCount:25;" position="0 0.2 0.2"></a-entity>
            </a-entity>

            <!-- door to main cave -->
            <a-plane position="0 0 -20" height="7" width="2" color="black" link="href: main_cave.html"></a-plane>

            <!-- add thunder storm sound effects -->
            <a-sound src="assets/Audio/sound_effects/thunder_01.wav" autoplay="true" loop="true"></a-sound>

            <!-- makes storm appear
                (doesnt do anything yet)
           
            <a-entity id="storm_button" position="-1 0 0">
                <a-entity class="button interactive" ; position="0 0.6 0" 
                    geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(100, 100, 255)"
                    animation__mouseenter="property:material.color; type:color; to:rgb(0, 0, 255); startEvents:mouseenter; dur:200"
                    animation__mouseleave="property:material.color; type:color; to:rgb(100, 100, 255); startEvents:mouseleave; dur:200"
                    animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>
             -->

            <!-- added a particle system component for rain (doesnt work yet) -->
            <a-assets>
                <img id="raindrop" src="https://cdn.glitch.global/a12af6de-b341-4b3a-8ddc-87007b4c52af/raindrop.png?v=1648672291940" crossorigin="anonymous">
            </a-assets>
              
              <a-entity id="rain-system" position="0 2.25 -15" particle-system="  maxAge:1;
                                                                 positionSpread:100 100 100; 
                                                                 rotationAngle:3.4; 
                                                                 accelerationValue:0 3 0;
                                                                 accelerationSpread:2 1 2;
                                                                 velocityValue:0 75 0;
                                                                 velocitySpread:10 50 10;
                                                                 color: #FFFFFF;
                                                                 size:0.1;
                                                                 texture:https://cdn.glitch.global/a12af6de-b341-4b3a-8ddc-87007b4c52af/raindrop.png?v=1648672291940;"></a-entity>


            <!-- makes thunderbird appear-->
            <a-entity id="thunderbird_button">
                <a-entity class="button interactive" thunderbird-appear ; position="0 0.6 0" 
                    sound="src: #thunderbird_01"
                    play-sound-on-event="mode: toggle-stop; event: click"
                    geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255, 100, 100)"
                    animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200"
                    animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200"
                    animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                    <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
                </a-entity>
            </a-entity>

            <a-entity   
                geometry="primitive: box; width:2.0; height:1.0; depth:0.2;" material="color:white;" 
                position="0 1.4 -1.5" rotation="-18 0 0" scale="1 1 1" shadow>
                <a-entity text="value: The Thunderbird is a supernatural enormous bird prominent in Northwest Coast Indigenous myths.;
                                color:black; font:roboto; width:1.5; anchor:center; baseline:top; wrapCount:25;" position="0 0.2 0.2"></a-entity>
                    
            </a-entity>

            <!-- thunderbird -->
            <a-entity id="orbitPoint">
                <a-sphere position="0 -2 0" rotation="0 0 0" color="grey" animation="property: rotation; to: 0 -360 0 ; loop: true; dur: 8000" rotation="0 0 0">
                    <a-entity id="thunderbird" visible="false">
                        <a-entity position="-5 25 -30" scale="0.03 0.03 0.03" gltf-model="#Thunderbird"></a-entity>
                    </a-entity>
                </a-sphere>
            </a-entity>

        </a-scene>
    </body>
</html>